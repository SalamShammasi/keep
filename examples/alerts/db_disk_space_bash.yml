# Check that SSH server is running and responsive
alert:
  id: ssh-reachability
  description: Check that the ssh service is reachable
  steps:
    - name: local-bash
      provider:
        type: bash
        with:
          command: stat nosuchfile
    - name: strip-stderr
      provider:
        type: mock
        config: "{{ providers.mock }}"
        with:
          command: false
          command_output: "keep.strip({{ steps.local-bash.results.stderr }})"
  actions:
    - name: trigger-slack
      throttle:
        type: one_until_resolved
      condition:
        - type: assert
          assert: "'{{ steps.local-bash.results.stderr }}' == ''"
      provider:
        type: slack
        config: " {{ providers.slack-demo }} "
        with:
          channel: db-is-down
          message: "ATTENTION: SSH reachability alert!"
          blocks:
          - type: divider
          - type: section
            text:
              type: mrkdwn
              text: |-
                Test Alert! Looks like the server is *UNREACHABLE* via SSH!
                Developers will not be able to connect to their VSCode servers
                Received stdout: *{{ steps.strip-stderr.results }}*

providers:
  mock:
    description: Mock Provider
    authentication:
