workflow:
  actions:
  - if: not '{{ alert.ticket_id }}'
    name: create-jira-ticket
    provider:
      config: '{{ providers.Jira }}'
      type: jira
      with:
        description: 'This ticket was created by Keep. Details: {{ alert }}'
        enrich_alert:
        - key: ticket_type
          value: jira
        - key: ticket_id
          value: results.issue.key
        - key: ticket_url
          value: results.ticket_url
        issuetype: Task
        project_key: KEEP
        summary: '[{{ alert.service }}] {{ alert.name }} - {{ alert.description }}'
  description: Route critical Sentry alerts
  id: sentry-critical-alerts-jira
  triggers:
  - filters:
    - key: source
      value: sentry
    - key: tags.severity
      value: critical
    type: alert
