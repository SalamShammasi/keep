alert:
  id: db-disk-space
  steps:
    - name: check-error-rate
      provider:
        type: datadog
        config: "{{ providers.datadog }}"
        with:
          query: "service:keep-github-app"
          timeframe: "3d"
          query_type: "logs"
  actions:
    - name: trigger-slack
      condition:
      - name: threshold-condition
        type: threshold
        value: "keep.len({{ steps.check-error-rate.results.logs }})"
        compare_to: 0
        operator: ">"
      provider:
        type: slack
        config: " {{ providers.slack-demo }} "
        with:
          channel: db-is-down
          # Message is always mandatory
          message: >
            The db is down. Please investigate.
          blocks:
          - type: section
            text:
              type: plain_text
              text: |
                    Query: {{ steps.check-error-rate.provider_parameters.query }}
                    Timeframe: {{ steps.check-error-rate.provider_parameters.timeframe }}
                    Number of logs: keep.len({{ steps.check-error-rate.results.logs }})
                    From: {{ steps.check-error-rate.provider_parameters.from }}
                    To: {{ steps.check-error-rate.provider_parameters.to }}

providers:
  db-server-mock:
    description: Paper DB Server
    authentication:
  datadog:
    authentication:
      api_key: 350d64edb07f5b4d3bf8383704e4b467
      app_key: 088d01168819e82e6ef41cd80920c2f50beb7fa1
